name: Deploy on Production Environment

on:
    push:
        branches: ["main"]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Run test
              uses: ./.github/workflows/test.yml

    build:
        needs: [test]
        runs-on: ubuntu-latest
        steps:
            - name: Build docker images
              uses: ./.github/workflows/build.yml
              with:
                  tags: ${{ github.ref }}
                  environment: production
                  registry_token: ${{ secrets.GITHUB_TOKEN }}

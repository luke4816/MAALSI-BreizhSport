name: Run deployment on staging environment

on:
    push:
        branches: ["releases/*"]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Run test
              uses: ./github/workflows/test.yml

    build:
        needs: [test]
        runs-on: ubuntu-latest
        steps:
            - name: Build docker images
              uses: ./github/workflows/build.yml
              with:
                  tags: ${{ github.ref }}-staging
                  environment: staging
                  registry_token: ${{ secrets.GITHUB_TOKEN }}
